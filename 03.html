<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시놉시스</title>


    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gugi&display=swap');


        body {
            overflow: hidden;
            background-image: url('back03.png');
            overflow: hidden;
            background-repeat: no-repeat;
            background-size: cover;

            background-position: center;
            font-family: "Gugi", sans-serif;
            font-style: normal;
            font-size: 15px;
            height: 100vh;

            width: 100vw;

        }

        /* 짐 배치할 자리 */
        #SuccessfulStuffs {
            position: absolute;
            top: 0%;

            left: -10%;
            width: 80vw;
            height: 80vh;
        }

        /* 개별 짐 요소의 스타일 */
        .successful-stuff-item {
            position: absolute;
            width: 60vw;
            height: 60vw;

            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0;
            cursor: pointer;
            z-index: 1000;


            animation:
                fall 2s ease-out forwards,
                spin 4s linear infinite;
            animation-delay: 0s, 2s;
        }


        /* --- 1. fall: 낙하 및 최종 위치, 이미지 변경 (2초) --- */
        @keyframes fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 0;
                background-image: var(--original-image);
            }

            50% {
                transform: translateY(-30vh) rotate(-20deg);
                opacity: 1;
                background-image: var(--changed-image);
            }

            100% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
                background-image: var(--changed-image);
            }
        }


        @keyframes spin {
            0% {
                transform: translateY(0) rotate(-10deg);
            }

            50% {
                transform: translateY(0) rotate(10deg);
            }

            100% {
                transform: translateY(0) rotate(-10deg);
            }
        }


        /*처음 뜨는 화면창*/
        .instruction-content {
            background-color: rgb(236, 247, 255);
            position: fixed;
            padding: 20px;
            left: 45%;
            transform: translate(-50%, -50%);
            top: 40%;
            border-radius: 8px;
            text-align: center;
            color: rgb(33, 12, 124);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            width: 60vw;
            font-size: 9px;

            opacity: 0.95;
            z-index: 100000;
        }

        .inst-close {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: rgb(33, 12, 124);
            color: rgb(255, 255, 255);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            z-index: 9999;
        }



        /*짐 설명 창*/

        #explanationWrapper {
            background-color: rgb(236, 247, 255);
            position: fixed;

            left: 40%;
            transform: translate(-50%, -50%);
            top: 40%;

            text-align: center;
            color: rgb(33, 12, 124);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            width: 60vw;
            font-size: 18px;
            border-radius: 10px;
            opacity: 0.95;
            z-index: 100000;
        }

        .explanation-content {
            background-color: rgb(114, 134, 214);
            padding: 20px;
            border-radius: 8px;
            text-align: center;

            width: 100%;


            color: white;
            font-family: "Gugi", sans-serif;
        }


        .exp-close {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #343585;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-family: "Gugi", sans-serif;
            text-decoration: none;
        }


        #next {
            font-size: 7vw;

            bottom: 5vh;
            right: 25%;
            padding: 15px 20px;
            font-weight: bold;
            background-color: #8b82eb;
            color: white;
            border: none;
            border-radius: 16px;
            font-family: "Gugi", sans-serif;
            position: absolute;
            display: none;
            z-index: 9999;
            text-decoration: none;
        }
    </style>
</head>

<body>


    <div id="instructionModal" class="instruction-content">
        <h1>울지 행성으로의 이사를
            <p>성공적으로 완료했어요!</p>
            내 짐이 새로운 보금자리에서
            <p>어떤 모습이 되었는지</p>
            <p>클릭해 확인해보세요!</p>
        </h1>
        <button class="inst-close" onclick="closeinstruction()">닫기</button>
    </div>

    <div id="SuccessfulStuffs"></div>

    <a id="next" href="04.html">이사 끝내기</a>


    <div id="explanationWrapper" style="display: none;">
        <div id="modalContent" class="explanation-content">
            <h2 id="modalTitle"></h2>
            <p id="modalImageContainer"></p>
            <p id="modalDescription"></p>
            <button class="exp-close" onclick="closeExplanation()">닫기</button>
        </div>
    </div>


    <script>

        const allStuffData = {
            "phone": {
                name: "휴대폰",
                description: "내 폰이 대형 티비가 됐네! 이제 큰 화면으로 영화를 볼 수 있겠어",
                left: "10%",
                top: "30%"

            },
            "seed": {
                name: "씨앗",
                description: "내가 달려오는 동안 우주에서의 시간이 얼마나 지난거지? 씨앗이 엄청난 나무가 됐잖아?",
                left: "70%",
                top: "35%"

            },
            "rainbow": {
                name: "무지개",
                description: "다른 곳으로 이동할 수 있는 무지개 다리가 생겼어, 그런데 어디로,,?",
                left: "10%",
                top: "55%"
            },
            "mirror": {
                name: "거울",
                description: "유리처럼 투명한 물의 호수가,,, 어? 내 거울이잖아?",
                left: "10%",
                top: "0%"
            },
            "door": {
                name: "문",
                description: "집에 훌륭한 대문이 생겼네! 문은 항상 열어두고 싶지만 말이야",
                left: "80%",
                top: "0%"
            },
            "matcha": {
                name: "말차 라떼",
                description: "말차 라떼가 쏟아지면서 수북한 이파리와 꽃이 자랐어!",
                left: "60%",
                top: "70%"
            }
        };

        // 초기 안내창 닫기
        function closeinstruction() {
            const instruction = document.getElementById('instructionModal');
            instruction.style.display = 'none';
        }
        window.closeinstruction = closeinstruction;


        const wrapper = document.getElementById('explanationWrapper');
        const modalTitle = document.getElementById('modalTitle');
        const modalDescription = document.getElementById('modalDescription');
        const nextButton = document.getElementById('next');
        const stuffContainer = document.getElementById('SuccessfulStuffs');
        const modalImageContainer = document.getElementById('modalImageContainer');


        const stuffChecked = {};
        let totalStuffs = 0;


        // 모든 짐 확인 여부 검사 및 '다음' 버튼 활성화
        function checkAllStuffChecked() {
            if (totalStuffs === 0) return;

            const allChecked = Object.values(stuffChecked).every(isChecked => isChecked === true);

            if (allChecked) {
                nextButton.style.display = 'block';
            }
        }


        // 팝업을 열고 정보 채우는 함수
        function openExplanation(name, description, stuffId) {
            modalTitle.textContent = name;
            modalDescription.textContent = description;

            // 바뀐 이미지(stuffId + '03.png')를 모달에 삽입하는 로직
            const changedImagePath = `${stuffId}03.png`;

            // 이미지 요소 생성 및 설정
            const imgElement = document.createElement('img');
            imgElement.src = changedImagePath;
            imgElement.alt = name;

            // ❗️ 이미지 크기 조정 (50px -> 100px)
            imgElement.style.maxWidth = '200px';
            imgElement.style.height = 'auto';
            imgElement.style.marginBottom = '10px';

            imgElement.style.borderRadius = '8px';


            modalImageContainer.innerHTML = '';
            modalImageContainer.appendChild(imgElement);

            wrapper.style.display = 'flex';

            stuffChecked[stuffId] = true;
        }

        // 팝업을 닫는 함수
        function closeExplanation() {
            wrapper.style.display = 'none';
            checkAllStuffChecked();
        }
        window.closeExplanation = closeExplanation;


        // 이전 페이지에서 데이터 불러와 짐 요소 동적 생성
        document.addEventListener('DOMContentLoaded', function () {
            const savedStuffsJSON = localStorage.getItem('SuccessfulStuffs');

            if (savedStuffsJSON) {
                const successfulStuffs = JSON.parse(savedStuffsJSON);
                totalStuffs = successfulStuffs.length;

                if (totalStuffs > 0) {
                    successfulStuffs.forEach(stuffId => {
                        const data = allStuffData[stuffId];
                        if (data) {
                            // 1. 짐 요소(div) 생성
                            const stuffElement = document.createElement('div');
                            stuffElement.className = 'successful-stuff-item';
                            stuffElement.id = stuffId;

                            // CSS 변수를 사용하여 이미지 경로를 애니메이션에 동적으로 전달
                            stuffElement.style.setProperty('--original-image', `url('${stuffId}.png')`);
                            stuffElement.style.setProperty('--changed-image', `url('${stuffId}03.png')`);

                            // 2. 스타일 및 데이터 적용 (위치)
                            stuffElement.style.left = data.left;
                            stuffElement.style.top = data.top;

                            // 3. 클릭 이벤트 리스너 추가
                            stuffElement.addEventListener('click', () => {
                                openExplanation(data.name, data.description, stuffId);
                            });

                            // 4. 컨테이너에 추가
                            stuffContainer.appendChild(stuffElement);

                            // 5. 확인 상태 초기화
                            stuffChecked[stuffId] = false;
                        }
                    });
                } else {
                    // 짐이 없을 경우 메시지 표시
                    stuffContainer.innerHTML = '<div style="position: absolute; top: 40%; left: 50%; transform: translateX(-50%); text-align: center;"><p>휑~,,, 빈털터리로 이사를 오게 되었어요. </p><p>괜찮아요, 이제부터 새로운 것들로 채워가면 되니까요!</p></div>';
                }
            } else {
                // 로컬 스토리지에 데이터가 없을 경우 메시지 표시
                stuffContainer.innerHTML = '<div style="position: absolute; top: 40%; left: 50%; transform: translateX(-50%); text-align: center;"><p>휑~,,, 빈털터리로 이사를 오게 되었어요. </p><p>괜찮아요, 이제부터 새로운 것들로 채워가면 되니까요!</p></div>';
            }
        });

    </script>

</body>

</html>