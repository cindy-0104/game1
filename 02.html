<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>행성으로 이동</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gugi&display=swap');



        body {
            overflow: hidden;
            margin: 0px;
            user-select: none;
            width: 100%;
            height: 100vh;



            background-image: url('spacepathback.png');
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;

            font-family: "Gugi", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        .dot-style {
            width: 20px;
            height: 20px;
            background-color: rgb(246, 201, 75);
            border-radius: 50%;

            transition: all 0.4s ease-out;
            z-index: 5;
            position: absolute;
        }








        .instruction-content {
            background-color: rgb(236, 247, 255);
            position: fixed;
            padding: 20px;
            left: 50%;
            transform: translate(-50%, -50%);
            top: 45%;
            border-radius: 8px;
            text-align: center;
            color: rgb(33, 12, 124);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            width: 60vw;
            font-size: 9px;

            opacity: 0.95;
            z-index: 100000;
        }

        .inst-close {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: rgb(33, 12, 124);
            color: rgb(255, 255, 255);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            z-index: 9999;
        }










        #moving-path-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            display: none;

            background-color: rgba(0, 0, 0, 0.85);

            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);


            flex-direction: column;
            align-items: center;
            justify-content: center;
            display: none;
        }

        #lightrain {
            height: 90vh;
            left: 0%;
            position: absolute;
            animation-iteration-count: infinite;

            mix-blend-mode: overlay;
            opacity: 1;
            animation: blinkRain 0.3s infinite alternate;
        }

        @keyframes blinkRain {
            0% {
                opacity: 0;
                /* 최소 불투명도 */
            }

            100% {
                opacity: 1;
                /* 최소 불투명도로 돌아옴 */
            }
        }


        #moving-path-container img {
            max-width: 80vw;
            max-height: 50vh;
            margin-bottom: 20px;
            border-radius: 5px;
            display: none;

        }


        #popup-message {
            color: white;
            font-size: 17px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;


        }


        #close-popup-btn {
            padding: 10px 20px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;

        }

        #close-popup-btn:hover {
            background-color: #45a049;

        }
    </style>
</head>

<body>

    <div id="moving-path-container">
        <div id="popup-message"></div>
        <img id="moving-path" src="" alt="이동 경로 이미지">
        <button id="close-popup-btn">계속 이동하기</button>
        <a href="03.html"></a>

    </div>




    <div id="instructionModal" class="instruction-content">
        <h1>울지 행성으로 이동중...
            <p>위부터 초록 길을 따라</p>
            손가락으로 선을 그려
            <p>울지 행성으로 떠나요!</p>
            <p>여정에 무엇을 마주칠까요?</p>
        </h1>
        <button class="inst-close" onclick="closeinstruction()">닫기</button>
    </div>



    <script>
        let isDrawing = false;
        let isPathShown = false;


        const TARGET_AREAS = [
            {
                name: "미지의 플래닛 2arth - 지구와 닮았지만 다른 이 행성은 뭐지...? 초록색으로 덮인 저건.. 숲이 아니라 곰팡이,,?",
                xMin: window.innerWidth * 0.2, xMax: window.innerWidth * 0.4,
                yMin: window.innerHeight * 0.2, yMax: window.innerHeight * 0.4,
                image: "planet1.png",
                reached: false
            },

            {
                name: "대왕 외계인 - 으악!! 또 나타났잖아 도망가자!",
                xMin: window.innerWidth * 0.2, xMax: window.innerWidth * 0.4,
                yMin: window.innerHeight * 0.6, yMax: window.innerHeight * 0.8,
                image: "eatingalien.png",
                reached: false
            },
            {
                name: "지구에서 날아와 우주를 부유하던 버섯들이 모이고, 우주 쓰레기를 먹이 삼아 비 정상적으로 커지더니, 버섯 행성을 이뤘어",
                xMin: window.innerWidth * 0.7, xMax: window.innerWidth * 0.9,
                yMin: window.innerHeight * 0.1, yMax: window.innerHeight * 0.3,
                image: "mushroom.png",
                reached: false
            },



            {
                name: "저기 빛이 보여! 울지 행성에 도착했나봐",

                xMin: window.innerWidth * 0.4, xMax: window.innerWidth * 0.6,
                yMin: window.innerHeight * 0.7, yMax: window.innerHeight * 1,
                image: "sparkle.png",
                reached: false
            },
        ];




        const movingPathContainer = document.getElementById('moving-path-container');
        const movingPathImage = document.getElementById('moving-path');
        const popupMessage = document.getElementById('popup-message'); // ⭐️ 문구 요소
        const closeBtn = document.getElementById('close-popup-btn'); // ⭐️ 닫기 버튼




        function showMovingPathImage(imageSrc, messageText) {
            if (isPathShown) return;
            isPathShown = true;
            // isDrawing 중단 로직은 제거 (선이 이어짐)

            movingPathImage.src = imageSrc;
            popupMessage.textContent = messageText;// ⭐️ 문구 설정
            movingPathImage.style.display = 'block';
            movingPathContainer.style.display = 'flex'; // ⭐️ flex로 변경하여 내용 표시
        }

        // 닫기 버튼 클릭 이벤트 
        function closePopup() {
            movingPathImage.style.display = 'none';
            movingPathContainer.style.display = 'none';
            isPathShown = false; // 해제해 다음 지점 감지하게
        }

        closeBtn.addEventListener('click', closePopup);



        function closeinstruction() {
            const instruction = document.getElementById('instructionModal');
            instruction.style.display = 'none';
        }
        window.closeinstruction = closeinstruction;





        //  점 그리기 함수 
        function drawDot(x, y) {

            const dot = document.createElement('div');
            dot.classList.add('dot-style');

            const size = 30;
            dot.style.left = (x - size / 2) + 'px';
            dot.style.top = (y - size / 2) + 'px';
            document.body.appendChild(dot);



        }

        // 좌표 검사 
        function checkTargetArea(x, y) {
            if (isPathShown) return;

            for (let area of TARGET_AREAS) {
                if (!area.reached &&
                    x >= area.xMin && x <= area.xMax &&
                    y >= area.yMin && y <= area.yMax) {

                    area.reached = true;

                    showMovingPathImage(area.image, area.name);

                    if (area.name === "저기 빛이 보여! 울지 행성에 도착했나봐") {
                        closeBtn.textContent = "행성에 도착!";


                        closeBtn.removeEventListener('click', closePopup);


                        closeBtn.addEventListener('click', () => {
                            window.location.href = "03.html";
                        });
                    }


                    return;
                }


            }
        }



        document.addEventListener('touchstart', (e) => {
            isDrawing = true;
            const x = e.touches[0].clientX;
            const y = e.touches[0].clientY;
            drawDot(x, y);
            checkTargetArea(x, y);
        });

        document.addEventListener('touchmove', (e) => {
            if (!isDrawing) return;

            const x = e.touches[0].clientX;
            const y = e.touches[0].clientY;

            drawDot(x, y);
            checkTargetArea(x, y);

            e.preventDefault();
        }, { passive: false });

        document.addEventListener('touchend', () => {
            isDrawing = false;
        });

    </script>
</body>