<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>행성으로 이동</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gugi&display=swap');



        body {
            overflow: hidden;
            margin: 0px;
            user-select: none;
            width: 100%;
            height: 100vh;
            color: white;


            background-image: url('spacepathback.png');
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;

            font-family: "Gugi", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        .dot-style {
            width: 20px;
            height: 20px;
            background-color: rgb(246, 201, 75);
            border-radius: 50%;

            transition: all 0.4s ease-out;
            z-index: 5;
            position: absolute;
        }


        #moving-path-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            display: none;

            background-color: rgba(0, 0, 0, 0.85);

            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);


            flex-direction: column;
            align-items: center;
            justify-content: center;
            display: none;
        }

        #lightrain {
            height: 90vh;
            left: 0%;
            position: absolute;
            animation-iteration-count: infinite;

            mix-blend-mode: overlay;
            opacity: 1;
            animation: blinkRain 0.3s infinite alternate;
        }

        @keyframes blinkRain {
            0% {
                opacity: 0;
                /* 최소 불투명도 */
            }

            100% {
                opacity: 1;
                /* 최소 불투명도로 돌아옴 */
            }
        }

        #moving-path-container img {
            max-width: 80vw;
            max-height: 50vh;
            margin-bottom: 20px;
            border-radius: 5px;
            display: none;

        }


        #popup-message {
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;


        }


        #close-popup-btn {
            padding: 10px 20px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;

        }

        #close-popup-btn:hover {
            background-color: #45a049;

        }
    </style>
</head>

<body>

    <div id="moving-path-container">
        <div id="popup-message"></div>
        <img id="moving-path" src="" alt="이동 경로 이미지">
        <button id="close-popup-btn">계속 이동하기</button>
        <a href="03.html"></a>
        <img id="fog" src="fog.png" alt="fog">
    </div>

    <h>울지 행성으로 이동중... </h>
    <script>
        let isDrawing = false;
        let isPathShown = false;


        const TARGET_AREAS = [
            {
                name: "첫 번째 행성: Planet A",
                xMin: window.innerWidth * 0.2, xMax: window.innerWidth * 0.4,
                yMin: window.innerHeight * 0.2, yMax: window.innerHeight * 0.4,
                image: "planet1.png",
                reached: false
            },

            {
                name: "미지의 존재: Eating Alien",
                xMin: window.innerWidth * 0.2, xMax: window.innerWidth * 0.4,
                yMin: window.innerHeight * 0.6, yMax: window.innerHeight * 0.8,
                image: "eatingalien.png",
                reached: false
            },
            {
                name: "버섯 행성: Mushroom Planet",
                xMin: window.innerWidth * 0.7, xMax: window.innerWidth * 0.9,
                yMin: window.innerHeight * 0.1, yMax: window.innerHeight * 0.3,
                image: "mushroom.png",
                reached: false
            },



            {
                name: "울지 행성 도착",

                xMin: window.innerWidth * 0.4, xMax: window.innerWidth * 0.6,
                yMin: window.innerHeight * 0.7, yMax: window.innerHeight * 1,
                image: "sparkle.png",
                reached: false
            },
        ];




        const movingPathContainer = document.getElementById('moving-path-container');
        const movingPathImage = document.getElementById('moving-path');
        const popupMessage = document.getElementById('popup-message'); // ⭐️ 문구 요소
        const closeBtn = document.getElementById('close-popup-btn'); // ⭐️ 닫기 버튼




        function showMovingPathImage(imageSrc, messageText) {
            if (isPathShown) return;
            isPathShown = true;
            // isDrawing 중단 로직은 제거 (선이 이어짐)

            movingPathImage.src = imageSrc;
            popupMessage.textContent = messageText;// ⭐️ 문구 설정
            movingPathImage.style.display = 'block';
            movingPathContainer.style.display = 'flex'; // ⭐️ flex로 변경하여 내용 표시
        }

        // 닫기 버튼 클릭 이벤트 
        function closePopup() {
            movingPathImage.style.display = 'none';
            movingPathContainer.style.display = 'none';
            isPathShown = false; // 해제해 다음 지점 감지하게
        }

        closeBtn.addEventListener('click', closePopup);







        //  점 그리기 함수 
        function drawDot(x, y) {

            const dot = document.createElement('div');
            dot.classList.add('dot-style');

            const size = 30;
            dot.style.left = (x - size / 2) + 'px';
            dot.style.top = (y - size / 2) + 'px';
            document.body.appendChild(dot);



        }

        // 좌표 검사 
        function checkTargetArea(x, y) {
            if (isPathShown) return;

            for (let area of TARGET_AREAS) {
                if (!area.reached &&
                    x >= area.xMin && x <= area.xMax &&
                    y >= area.yMin && y <= area.yMax) {

                    area.reached = true;

                    showMovingPathImage(area.image, area.name);

                    if (area.name === "울지 행성 도착") {
                        closeBtn.textContent = "다음 화면으로 이동";


                        closeBtn.removeEventListener('click', closePopup);


                        closeBtn.addEventListener('click', () => {
                            window.location.href = "03.html";
                        });
                    }


                    return;
                }


            }
        }



        document.addEventListener('touchstart', (e) => {
            isDrawing = true;
            const x = e.touches[0].clientX;
            const y = e.touches[0].clientY;
            drawDot(x, y);
            checkTargetArea(x, y);
        });

        document.addEventListener('touchmove', (e) => {
            if (!isDrawing) return;

            const x = e.touches[0].clientX;
            const y = e.touches[0].clientY;

            drawDot(x, y);
            checkTargetArea(x, y);

            e.preventDefault();
        }, { passive: false });

        document.addEventListener('touchend', () => {
            isDrawing = false;
        });

    </script>
</body>